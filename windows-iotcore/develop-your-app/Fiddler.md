---
title: 捕获 Fiddler 跟踪
ms.date: 08/28/2017
ms.topic: article
ms.prod: windows-iot
ms.technology: iot
description: 了解如何使用 Fiddler 捕获 Windows IoT Core 上的 Fiddler 跟踪。
keywords: windows iot，Fiddler，跟踪，PuTTY，Fiddler 跟踪
ms.openlocfilehash: 11e246a2f1d373040c66c8ab0c723974712776ce
ms.sourcegitcommit: 938c83c2823304341ce6022d12eeed037c119112
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/02/2021
ms.locfileid: "113229043"
---
# <a name="capturing-fiddler-traces-on-windows-iot-core"></a><span data-ttu-id="259f8-104">捕获 Windows IoT Core 上的 Fiddler 跟踪</span><span class="sxs-lookup"><span data-stu-id="259f8-104">Capturing Fiddler Traces on Windows IoT Core</span></span>

<span data-ttu-id="259f8-105">Fiddler 是一种用于调试 web 流量的工具。</span><span class="sxs-lookup"><span data-stu-id="259f8-105">Fiddler is a tool for debugging web traffic.</span></span> <span data-ttu-id="259f8-106">此方法特别有用，因为你可以使用扩展和加载项对其进行自定义，并且该工具提供了特定于 web 流量的大量有用信息。</span><span class="sxs-lookup"><span data-stu-id="259f8-106">It's particularly helpful because you can customize it for specific needs using extensions and add-ons, and the tool provides a lot of useful information specific to web traffic.</span></span>

## <a name="assumptions"></a><span data-ttu-id="259f8-107">假设</span><span class="sxs-lookup"><span data-stu-id="259f8-107">Assumptions</span></span>

* <span data-ttu-id="259f8-108">你的开发人员机箱或 SSH 的替代方法[PuTTY](http://www.putty.org/)</span><span class="sxs-lookup"><span data-stu-id="259f8-108">You have [PuTTY](http://www.putty.org/) on your developer box or an alternative for SSH</span></span>
* <span data-ttu-id="259f8-109">以下说明对 IoT 核心 VM 进行了假设，但可在 *任何* IoT 核心设备上使用</span><span class="sxs-lookup"><span data-stu-id="259f8-109">The instructions below make the assumption of a IoT Core VM but will work on *any* IoT Core device</span></span>

## <a name="initial-setup"></a><span data-ttu-id="259f8-110">初始设置</span><span class="sxs-lookup"><span data-stu-id="259f8-110">Initial Setup</span></span>

1. <span data-ttu-id="259f8-111">下载并安装最新版本的 [Fiddler](http://www.telerik.com/fiddler/) （如果尚未安装）</span><span class="sxs-lookup"><span data-stu-id="259f8-111">Download and install the latest version of [Fiddler](http://www.telerik.com/fiddler/) on your developer box if you haven't already</span></span>
2. <span data-ttu-id="259f8-112">启动 Fiddler，然后在 " _工具-> Telerik Fiddler 选项-> HTTPS_ " 选项卡下执行以下设置更新</span><span class="sxs-lookup"><span data-stu-id="259f8-112">Start Fiddler and make the following setting updates under _Tools -> Telerik Fiddler Options -> HTTPS_ tab</span></span>
    * <span data-ttu-id="259f8-113">选中 "_捕获 HTTPS 连接_"</span><span class="sxs-lookup"><span data-stu-id="259f8-113">Check _Capture HTTPS CONNECTs_</span></span>
    * <span data-ttu-id="259f8-114">检查 _解密 HTTPS 流量-从所有进程 >_</span><span class="sxs-lookup"><span data-stu-id="259f8-114">Check _Decrypt HTTPS Traffic -> from all processes_</span></span>
    * <span data-ttu-id="259f8-115">单击 "生成的证书" 链接，然后选择 " _MakeCert engine_ " (建议： Restart Fiddler，使此更改生效) </span><span class="sxs-lookup"><span data-stu-id="259f8-115">Click on the 'Certificates generated by' link and select _MakeCert engine_ (Recommendation: Restart Fiddler for this change to take effect)</span></span>
    * <span data-ttu-id="259f8-116">接下来，通过操作导出 FiddlerRoot 文件 _-> 将根证书导出到桌面_</span><span class="sxs-lookup"><span data-stu-id="259f8-116">Next, export the FiddlerRoot.cer file via _Actions -> Export Root Certificate To Desktop_</span></span>
3. <span data-ttu-id="259f8-117">在 " _工具-> Telerik Fiddler 选项-> 连接_ " 选项卡下执行以下设置更新：</span><span class="sxs-lookup"><span data-stu-id="259f8-117">Make the following setting updates under _Tools -> Telerik Fiddler Options -> Connections_ tab:</span></span>
    * <span data-ttu-id="259f8-118">通过选中 "_允许远程计算机连接_"，将 Fiddler 设置为系统代理</span><span class="sxs-lookup"><span data-stu-id="259f8-118">Setup Fiddler to act as a system proxy by checking _Allow Remote Computers to Connect_</span></span>
    * <span data-ttu-id="259f8-119">_Fiddler 侦听端口_ 应设置为 _8888_</span><span class="sxs-lookup"><span data-stu-id="259f8-119">_Fiddler listens on port_ should be set to _8888_</span></span>

<span data-ttu-id="259f8-120">注意：应在此之后重新启动 Fiddler 并接受任何 UAC 提示。</span><span class="sxs-lookup"><span data-stu-id="259f8-120">Note: You should restart Fiddler after this and accept any UAC prompt.</span></span>

## <a name="transfer-and-import-fiddler-root-certificate"></a><span data-ttu-id="259f8-121">传输和导入 Fiddler 根证书</span><span class="sxs-lookup"><span data-stu-id="259f8-121">Transfer and Import Fiddler Root Certificate</span></span>
<span data-ttu-id="259f8-122">需要将 Fiddler 根证书导入到 IoT 映像或设备，以便通过电脑调试 https 流量路由。</span><span class="sxs-lookup"><span data-stu-id="259f8-122">You'll need to import the Fiddler root certificate to your IoT image or device in order to debug https traffic routing through your PC.</span></span>  <span data-ttu-id="259f8-123">要执行此操作：</span><span class="sxs-lookup"><span data-stu-id="259f8-123">To do this:</span></span>

1. <span data-ttu-id="259f8-124">安装 VHD 文件 (右键单击 VHD，然后选择 " _装载_) " 或 "通过 PuTTY (或备用 SSH 客户端连接到 IoT 设备") </span><span class="sxs-lookup"><span data-stu-id="259f8-124">Mount the VHD file (right click on the VHD and choose _mount_) or connect to your IoT device via PuTTY (or alternative SSH client)</span></span>
2. <span data-ttu-id="259f8-125">浏览到 mainOS 分区，并通过 SSH 在根 (创建 _测试_ 文件夹，使用 _md c:\test_) </span><span class="sxs-lookup"><span data-stu-id="259f8-125">Browse to the mainOS partition and create a _test_ folder at root (via SSH, use _md c:\test_)</span></span>
3. <span data-ttu-id="259f8-126">复制上面生成的 FiddlerRoot (应默认位于桌面上) 到测试文件夹位置</span><span class="sxs-lookup"><span data-stu-id="259f8-126">Copy FiddlerRoot.cer you generated above (should be on your desktop by default) to the test folder location</span></span>
4. <span data-ttu-id="259f8-127">如果使用 VHD，请通过弹出任何已装载的驱动器将其卸载，然后通过 Hyper-v 启动 IoT 核心 VM</span><span class="sxs-lookup"><span data-stu-id="259f8-127">If using a VHD, unmount it by ejecting any of the mounted drives and then start the IoT Core VM via Hyper-V</span></span>
5. <span data-ttu-id="259f8-128">启动 [SSH 会话](../connect-your-device/ssh.md) 并以管理员身份登录</span><span class="sxs-lookup"><span data-stu-id="259f8-128">Start an [SSH session](../connect-your-device/ssh.md) and login as administrator</span></span>
6. <span data-ttu-id="259f8-129">导航到 SSH 会话中的 c:\test 目录</span><span class="sxs-lookup"><span data-stu-id="259f8-129">Navigate to c:\test directory in your SSH session</span></span>
7. <span data-ttu-id="259f8-130">通过命令导入 Fiddler 根证书：</span><span class="sxs-lookup"><span data-stu-id="259f8-130">Import Fiddler Root Certificate via command:</span></span>
    * `certmgr -add FiddlerRoot.cer -r localmachine -s root`
8. <span data-ttu-id="259f8-131">关闭 SSH 会话</span><span class="sxs-lookup"><span data-stu-id="259f8-131">Close SSH session</span></span>


## <a name="setup-proxy-on-vm-or-iot-core-device"></a><span data-ttu-id="259f8-132">在 VM 或 IoT 核心设备上设置代理</span><span class="sxs-lookup"><span data-stu-id="259f8-132">Setup Proxy on VM or IoT Core Device</span></span>
<span data-ttu-id="259f8-133">以下步骤将允许 IoT VM 或设备通过电脑路由流量，使 Fiddler 可以捕获用于分析的网络流量：</span><span class="sxs-lookup"><span data-stu-id="259f8-133">The steps below will allow your IoT VM or device to route traffic through your PC so that Fiddler can capture network traffic for analysis:</span></span>

1. <span data-ttu-id="259f8-134">通过 _ipconfig_ 使用 CMD 控制台确定开发计算机的 IP</span><span class="sxs-lookup"><span data-stu-id="259f8-134">Determine the IP of your development machine using a CMD console via _ipconfig_</span></span>
2. <span data-ttu-id="259f8-135">启动新的 SSH 会话，然后以 defaultUser 的身份登录 (Username： _DefaultAccount_  Pwd： _[空白]_ ) </span><span class="sxs-lookup"><span data-stu-id="259f8-135">Start a new SSH session and this time, login as defaultUser (Username: _DefaultAccount_  Pwd: _[blank]_ )</span></span>
3. <span data-ttu-id="259f8-136">通过以下命令设置代理：</span><span class="sxs-lookup"><span data-stu-id="259f8-136">Set the proxy via the following commands:</span></span>
    * `reg add "hkcu\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyEnable /t REG_DWORD /d 1`
    * `reg add "hkcu\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyServer /t REG_SZ /d [PC IP address]:8888`

<span data-ttu-id="259f8-137">如果尚未运行，请在你的电脑上启动 Fiddler，重新启动 VM 或 IoT 核心设备，流量现在应通过 Fiddler 路由。</span><span class="sxs-lookup"><span data-stu-id="259f8-137">If not already running, start Fiddler on your PC, restart your VM or IoT Core device and traffic should now be routed through Fiddler.</span></span>

<span data-ttu-id="259f8-138">注意：如果你在 Fiddler 中看到 https 连接，但没有数据，则可能是证书安装不正确。</span><span class="sxs-lookup"><span data-stu-id="259f8-138">Note: If you see https CONNECT in Fiddler but no data, the certificate was likely not installed correctly.</span></span> <span data-ttu-id="259f8-139">请确保未错过上述 _传输和导入 Fiddler 根证书_ 的步骤。</span><span class="sxs-lookup"><span data-stu-id="259f8-139">Make sure you didn't miss the _Transfer and Import Fiddler Root Certificate_ steps above.</span></span>

<span data-ttu-id="259f8-140">此外，如果想要重新打开代理，请注意，上面的注册表项会缓存在另一个键的二进制 blob 中。</span><span class="sxs-lookup"><span data-stu-id="259f8-140">Additionally, if you wish to turn the proxy back off note that the above reg keys get cached in a binary blob in another key.</span></span> <span data-ttu-id="259f8-141">因此，除了删除刚刚在上面的步骤3中添加的密钥，还需要执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="259f8-141">so, in addition to removing the keys just added in step 3 above you also need to do:</span></span>
```
    reg delete "hkcu\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections"
```

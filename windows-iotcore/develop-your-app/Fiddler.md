---
title: 捕获 Fiddler 跟踪
author: saraclay
ms.author: saclayt
ms.date: 08/28/2017
ms.topic: article
description: 了解如何使用 Fiddler 捕获 Fiddler 跟踪在 Windows IoT Core 上。
keywords: windows iot，Fiddler，跟踪，PuTTY，Fiddler 跟踪
ms.openlocfilehash: b8bf4fa6390aad9640ad9139a8a164a9c83fcff5
ms.sourcegitcommit: ef85ccba54b1118d49554e88768240020ff514b0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/11/2019
ms.locfileid: "59510865"
---
# <a name="capturing-fiddler-traces-on-windows-iot-core"></a><span data-ttu-id="e37dd-104">捕获 Windows IoT Core 上的 Fiddler 跟踪</span><span class="sxs-lookup"><span data-stu-id="e37dd-104">Capturing Fiddler Traces on Windows IoT Core</span></span>

<span data-ttu-id="e37dd-105">Fiddler 是一个用于调试的 web 流量工具。</span><span class="sxs-lookup"><span data-stu-id="e37dd-105">Fiddler is a tool for debugging web traffic.</span></span> <span data-ttu-id="e37dd-106">该功能特别有用，因为你可以为特定需要，使用扩展和外接程序，自定义它，并且该工具提供了大量有用的信息特定于 web 流量。</span><span class="sxs-lookup"><span data-stu-id="e37dd-106">It's particularly helpful because you can customize it for specific needs using extensions and add-ons, and the tool provides a lot of useful information specific to web traffic.</span></span>

## <a name="assumptions"></a><span data-ttu-id="e37dd-107">假设</span><span class="sxs-lookup"><span data-stu-id="e37dd-107">Assumptions</span></span> 

* <span data-ttu-id="e37dd-108">你有[PuTTY](http://www.putty.org/)上在开发人员工具箱或 SSH 的替代方法</span><span class="sxs-lookup"><span data-stu-id="e37dd-108">You have [PuTTY](http://www.putty.org/) on your developer box or an alternative for SSH</span></span>
* <span data-ttu-id="e37dd-109">下面的说明假设 IoT Core VM 但上将起作用*任何*IoT Core 设备</span><span class="sxs-lookup"><span data-stu-id="e37dd-109">The instructions below make the assumption of a IoT Core VM but will work on *any* IoT Core device</span></span>

## <a name="initial-setup"></a><span data-ttu-id="e37dd-110">初始设置</span><span class="sxs-lookup"><span data-stu-id="e37dd-110">Initial Setup</span></span>

1. <span data-ttu-id="e37dd-111">下载并安装最新版[Fiddler](http://www.telerik.com/fiddler/)如果尚未在开发人员工具箱上</span><span class="sxs-lookup"><span data-stu-id="e37dd-111">Download and install the latest version of [Fiddler](http://www.telerik.com/fiddler/) on your developer box if you haven't already</span></span>
2. <span data-ttu-id="e37dd-112">启动 Fiddler，进行以下设置更新下的_工具-> Telerik Fiddler 选项-> HTTPS_选项卡</span><span class="sxs-lookup"><span data-stu-id="e37dd-112">Start Fiddler and make the following setting updates under _Tools -> Telerik Fiddler Options -> HTTPS_ tab</span></span>
    * <span data-ttu-id="e37dd-113">检查_捕获 HTTPS 连接_</span><span class="sxs-lookup"><span data-stu-id="e37dd-113">Check _Capture HTTPS CONNECTs_</span></span>
    * <span data-ttu-id="e37dd-114">检查_解密 HTTPS 通信-> 与所有进程_</span><span class="sxs-lookup"><span data-stu-id="e37dd-114">Check _Decrypt HTTPS Traffic -> from all processes_</span></span>
    * <span data-ttu-id="e37dd-115">单击证书生成的链接，然后选择_MakeCert 引擎_(建议：重启 Fiddler，此更改才会生效）</span><span class="sxs-lookup"><span data-stu-id="e37dd-115">Click on the 'Certificates generated by' link and select _MakeCert engine_ (Recommendation: Restart Fiddler for this change to take effect)</span></span>
    * <span data-ttu-id="e37dd-116">接下来，导出 FiddlerRoot.cer 文件通过_操作-> 将根证书导出到桌面_</span><span class="sxs-lookup"><span data-stu-id="e37dd-116">Next, export the FiddlerRoot.cer file via _Actions -> Export Root Certificate To Desktop_</span></span>
3. <span data-ttu-id="e37dd-117">进行以下设置更新下的_工具-> Telerik Fiddler 选项-> 连接_选项卡：</span><span class="sxs-lookup"><span data-stu-id="e37dd-117">Make the following setting updates under _Tools -> Telerik Fiddler Options -> Connections_ tab:</span></span>
    * <span data-ttu-id="e37dd-118">安装 Fiddler 来充当系统代理通过检查_允许远程计算机连接到连接_</span><span class="sxs-lookup"><span data-stu-id="e37dd-118">Setup Fiddler to act as a system proxy by checking _Allow Remote Computers to Connect_</span></span>
    * <span data-ttu-id="e37dd-119">_Fiddler 侦听端口_应设置为_8888_</span><span class="sxs-lookup"><span data-stu-id="e37dd-119">_Fiddler listens on port_ should be set to _8888_</span></span>
  
<span data-ttu-id="e37dd-120">注意：应在此之后重启 Fiddler，并接受任何 UAC 提示。</span><span class="sxs-lookup"><span data-stu-id="e37dd-120">Note: You should restart Fiddler after this and accept any UAC prompt.</span></span>

## <a name="transfer-and-import-fiddler-root-certificate"></a><span data-ttu-id="e37dd-121">传输并导入 Fiddler 根证书</span><span class="sxs-lookup"><span data-stu-id="e37dd-121">Transfer and Import Fiddler Root Certificate</span></span>
<span data-ttu-id="e37dd-122">你将需要导入到你的 IoT 映像或设备以调试 https 流量路由通过您的 PC Fiddler 根证书。</span><span class="sxs-lookup"><span data-stu-id="e37dd-122">You'll need to import the Fiddler root certificate to your IoT image or device in order to debug https traffic routing through your PC.</span></span>  <span data-ttu-id="e37dd-123">要实现此目的，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="e37dd-123">To do this:</span></span>

1. <span data-ttu-id="e37dd-124">装载 VHD 文件 (在 VHD 上右键单击并选择_装载_) 或连接到 IoT 设备通过 PuTTY （或替代 SSH 客户端）</span><span class="sxs-lookup"><span data-stu-id="e37dd-124">Mount the VHD file (right click on the VHD and choose _mount_) or connect to your IoT device via PuTTY (or alternative SSH client)</span></span>
2. <span data-ttu-id="e37dd-125">浏览到 mainOS 分区和创建_测试_位于根文件夹 (通过 ssh 连接，使用_md c:\test_)</span><span class="sxs-lookup"><span data-stu-id="e37dd-125">Browse to the mainOS partition and create a _test_ folder at root (via SSH, use _md c:\test_)</span></span>
3. <span data-ttu-id="e37dd-126">复制上述生成的 FiddlerRoot.cer （应为默认情况下在桌面上） 到测试文件夹位置</span><span class="sxs-lookup"><span data-stu-id="e37dd-126">Copy FiddlerRoot.cer you generated above (should be on your desktop by default) to the test folder location</span></span>
4. <span data-ttu-id="e37dd-127">如果使用的 VHD，通过弹出任何已装载的驱动器来卸载它，然后启动 IoT Core VM 通过 HyperV</span><span class="sxs-lookup"><span data-stu-id="e37dd-127">If using a VHD, unmount it by ejecting any of the mounted drives and then start the IoT Core VM via HyperV</span></span>
5. <span data-ttu-id="e37dd-128">启动[SSH 会话](../connect-your-device/ssh.md)并以管理员身份登录</span><span class="sxs-lookup"><span data-stu-id="e37dd-128">Start an [SSH session](../connect-your-device/ssh.md) and login as administrator</span></span> 
6. <span data-ttu-id="e37dd-129">在 SSH 会话中导航到 c:\test 目录</span><span class="sxs-lookup"><span data-stu-id="e37dd-129">Navigate to c:\test directory in your SSH session</span></span>
7. <span data-ttu-id="e37dd-130">通过命令导入 Fiddler 根证书：</span><span class="sxs-lookup"><span data-stu-id="e37dd-130">Import Fiddler Root Certificate via command:</span></span>
    * `certmgr -add FiddlerRoot.cer -r localmachine -s root`
8. <span data-ttu-id="e37dd-131">关闭 SSH 会话</span><span class="sxs-lookup"><span data-stu-id="e37dd-131">Close SSH session</span></span>


## <a name="setup-proxy-on-vm-or-iot-core-device"></a><span data-ttu-id="e37dd-132">在 VM 或 IoT Core 设备上安装代理</span><span class="sxs-lookup"><span data-stu-id="e37dd-132">Setup Proxy on VM or IoT Core Device</span></span>
<span data-ttu-id="e37dd-133">执行以下步骤将允许你的 IoT VM 或将流量路由到您的 PC 的设备，因此该 Fiddler 可以捕获网络流量以进行分析：</span><span class="sxs-lookup"><span data-stu-id="e37dd-133">The steps below will allow your IoT VM or device to route traffic through your PC so that Fiddler can capture network traffic for analysis:</span></span>

1. <span data-ttu-id="e37dd-134">确定使用 CMD 控制台中的，通过在开发计算机的 IP _ipconfig_</span><span class="sxs-lookup"><span data-stu-id="e37dd-134">Determine the IP of your development machine using a CMD console via _ipconfig_</span></span>
2. <span data-ttu-id="e37dd-135">开始一个新的 SSH 会话，这一次，defaultUser 作为登录名 (用户名：_DefaultAccount_ Pwd: _[空白]_ )</span><span class="sxs-lookup"><span data-stu-id="e37dd-135">Start a new SSH session and this time, login as defaultUser (Username: _DefaultAccount_  Pwd: _[blank]_ )</span></span>
3. <span data-ttu-id="e37dd-136">设置代理通过以下命令：</span><span class="sxs-lookup"><span data-stu-id="e37dd-136">Set the proxy via the following commands:</span></span>
    * `reg add "hkcu\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyEnable /t REG_DWORD /d 1`
    * `reg add "hkcu\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyServer /t REG_SZ /d [PC IP address]:8888`

<span data-ttu-id="e37dd-137">如果尚未运行，在您的 PC 上启动 Fiddler、 重启 VM 或 IoT Core 设备和现在应该通过 Fiddler 路由流量。</span><span class="sxs-lookup"><span data-stu-id="e37dd-137">If not already running, start Fiddler on your PC, restart your VM or IoT Core device and traffic should now be routed through Fiddler.</span></span> 

<span data-ttu-id="e37dd-138">注意：如果您看到的 https 连接中 Fiddler 但没有数据，该证书时可能未正确安装。</span><span class="sxs-lookup"><span data-stu-id="e37dd-138">Note: If you see https CONNECT in Fiddler but no data, the certificate was likely not installed correctly.</span></span> <span data-ttu-id="e37dd-139">请确保未遗漏_传输和导入 Fiddler 的根证书_上述步骤。</span><span class="sxs-lookup"><span data-stu-id="e37dd-139">Make sure you didn't miss the _Transfer and Import Fiddler Root Certificate_ steps above.</span></span>

<span data-ttu-id="e37dd-140">此外，如果你想要启用退避注意上面的注册表密钥获取缓存在另一个密钥中的二进制 blob 中的代理。</span><span class="sxs-lookup"><span data-stu-id="e37dd-140">Additonally, if you wish to turn the proxy back off note that the above reg keys get cached in a binary blob in another key.</span></span> <span data-ttu-id="e37dd-141">因此，除了删除刚在上面的步骤 3 中添加的键还需要执行操作：</span><span class="sxs-lookup"><span data-stu-id="e37dd-141">so, in addition to removing the keys just added in step 3 above you also need to do:</span></span>

    reg delete "hkcu\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections"
    
    

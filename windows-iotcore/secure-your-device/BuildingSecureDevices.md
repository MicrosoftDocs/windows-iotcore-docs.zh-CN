---
title: 构建安全使用 Windows 10 IoT Core 设备
author: saraclay
ms.author: saclayt
ms.date: 08/28/2017
ms.topic: article
description: 了解如何构建安全的设备通过启用安全启动，实现了 Tpm，和的详细信息。
keywords: windows iot、 安全性、 固件、 安全启动，TPM，Bitlocker 加密
ms.openlocfilehash: 3ed1ca0adf77a76c121c68adc0c03a331871a3ad
ms.sourcegitcommit: 77b86eee2bba3844e87f9d3dbef816761ddf0dd9
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/11/2019
ms.locfileid: "65533310"
---
# <a name="building-secure-devices-with-windows-10-iot-core"></a><span data-ttu-id="f0083-104">构建安全使用 Windows 10 IoT Core 设备</span><span class="sxs-lookup"><span data-stu-id="f0083-104">Building Secure Devices with Windows 10 IoT Core</span></span>

## <a name="introduction"></a><span data-ttu-id="f0083-105">简介</span><span class="sxs-lookup"><span data-stu-id="f0083-105">Introduction</span></span>  
<span data-ttu-id="f0083-106">随着 Windows 10 IoT 核心版推出，Microsoft 将强企业级安全功能，可以利用这些较小的、 资源约束类 IoT 设备上。</span><span class="sxs-lookup"><span data-stu-id="f0083-106">With the introduction of Windows 10 IoT Core, Microsoft is bringing strong enterprise grade security features that can be leveraged on smaller, resource-constrained classes of IoT devices.</span></span>  <span data-ttu-id="f0083-107">这些安全功能，提供切实的益处，硬件平台还必须提供一种方法，若要定位到它们。</span><span class="sxs-lookup"><span data-stu-id="f0083-107">In order for these security features to offer tangible benefits, the hardware platform must also provide a means to anchor them.</span></span> <span data-ttu-id="f0083-108">本文档提供了概括性指导 OEM 设备构建者和安全意识"制造商"想要选择适当的硬件和生成、 配置和安全 IoT 设备寄给他们的客户。</span><span class="sxs-lookup"><span data-stu-id="f0083-108">This document provides high-level guidance to OEM device builders and security conscious "Makers" who are looking to select appropriate hardware and build, configure, and ship a secure IoT device to their customers.</span></span> 

## <a name="firmware"></a><span data-ttu-id="f0083-109">固件</span><span class="sxs-lookup"><span data-stu-id="f0083-109">Firmware</span></span>  
<span data-ttu-id="f0083-110">在常规用途计算了"打开"，如 Pc 的设备，用户可以通过各种键组合 （例如 F2 进入 UEFI 设置大多数 pc 立即） 的设备启动期间访问固件设置。</span><span class="sxs-lookup"><span data-stu-id="f0083-110">On general purpose computing devices that are "open", such as PCs, users can access firmware settings during device boot through various key combinations (e.g. F2 enters UEFI setup on most PCs today).</span></span> <span data-ttu-id="f0083-111">这可以允许用户在该平台启动，以及启用和禁用各种设备端口、 函数和其他潜在的安全功能，可在设备上进行更改。</span><span class="sxs-lookup"><span data-stu-id="f0083-111">This can allow users to make changes in how the platform boots as well as enable and disable various device ports, functions, and other potential security features available on the device.</span></span>  

<span data-ttu-id="f0083-112">给定此类修改的敏感性质，IoT 设备应不起作用"打开设备"和等更像"锁定"设备，类似于移动电话，其中对固件通常不允许访问工作。</span><span class="sxs-lookup"><span data-stu-id="f0083-112">Given the sensitive nature of such modifications, IoT devices should not function like "open devices", and should function more like "locked-down" devices, similar to mobile phones, where access to firmware is generally not permitted.</span></span>  <span data-ttu-id="f0083-113">这通常可以通过确保在你的生产设备中使用锁定的固件来完成。</span><span class="sxs-lookup"><span data-stu-id="f0083-113">This can normally be accomplished by ensuring you are using locked-down firmware in your production device.</span></span> <span data-ttu-id="f0083-114">锁定的固件应可通过固件提供程序。</span><span class="sxs-lookup"><span data-stu-id="f0083-114">Locked-down firmware should be available through your firmware provider.</span></span>  <span data-ttu-id="f0083-115">锁定的固件不可用或可能不合适，如创建者，供使用的位置的设备上至少应考虑保护通过管理员强密码的固件设置访问权限。</span><span class="sxs-lookup"><span data-stu-id="f0083-115">At minimum, on devices where locked-down firmware is not available or potentially unsuitable, such as for use by Makers, consider protecting firmware settings access via a strong administrator password.</span></span>

## <a name="enabling-secure-boot"></a><span data-ttu-id="f0083-116">启用安全启动</span><span class="sxs-lookup"><span data-stu-id="f0083-116">Enabling Secure Boot</span></span>
<span data-ttu-id="f0083-117">Windows 10 IoT 核心版将在实现统一可扩展固件接口 (UEFI) 的设备上启动。</span><span class="sxs-lookup"><span data-stu-id="f0083-117">Windows 10 IoT Core will boot on devices that implement Unified Extensible Firmware Interface (UEFI).</span></span>  <span data-ttu-id="f0083-118">标准 UEFI 实现称为安全启动一项安全功能。</span><span class="sxs-lookup"><span data-stu-id="f0083-118">The UEFI standard implements a security feature known as Secure Boot.</span></span> <span data-ttu-id="f0083-119">这允许为仅限制为只允许执行指定的颁发机构签名的二进制文件在系统启动受信任的软件的设备。</span><span class="sxs-lookup"><span data-stu-id="f0083-119">This allows a device to only boot trusted software by restricting the system to only allow execution of binaries signed by a specified authority.</span></span>  <span data-ttu-id="f0083-120">当设备启动后，UEFI 安全引导将检查引导软件，包括固件驱动程序和操作系统每段的签名。</span><span class="sxs-lookup"><span data-stu-id="f0083-120">When a device is powered-up, UEFI Secure Boot checks the signature of each piece of boot software, including firmware drivers and the OS.</span></span>  <span data-ttu-id="f0083-121">如果签名不匹配 (例如如果攻击者使用受攻击的 OS 替换原始图像) 平台将不会启动。</span><span class="sxs-lookup"><span data-stu-id="f0083-121">If the signatures do not match (e.g. if an attacker were to replace the original image with a compromised OS) the platform will not boot.</span></span> <span data-ttu-id="f0083-122">如果签名验证，很好，设备将继续启动，然后为控件提供了对操作系统。</span><span class="sxs-lookup"><span data-stu-id="f0083-122">If the signatures are verified and good, the device continues to boot and then gives control to the operating system.</span></span>  <span data-ttu-id="f0083-123">请注意，虽然与一组定义发布颁发机构的限制不包括所有未知的代码，它不一定会防止已知错误的代码执行 （例如回滚攻击）。</span><span class="sxs-lookup"><span data-stu-id="f0083-123">Note that while the limitation to a defined set of publishing authorities excludes all unknown code, it does not necessarily prevent known bad code from being executed (e.g. rollback attacks).</span></span>  <span data-ttu-id="f0083-124">强烈建议启用安全启动，如果您的固件支持它。</span><span class="sxs-lookup"><span data-stu-id="f0083-124">Enabling Secure Boot is strongly recommended if your firmware supports it.</span></span> 

<span data-ttu-id="f0083-125">设备制造商需要存储到其设备上的安全启动数据库。</span><span class="sxs-lookup"><span data-stu-id="f0083-125">Device manufacturers will need to store the Secure Boot databases onto their devices.</span></span>  <span data-ttu-id="f0083-126">这包括签名数据库 (db)、 已撤消的签名数据库 (dbx) 和数据库密钥注册密钥 (KEK)。</span><span class="sxs-lookup"><span data-stu-id="f0083-126">This includes the signature database (db), revoked signatures database (dbx), and Key Enrollment Key database (KEK).</span></span>  <span data-ttu-id="f0083-127">这些数据库通常在制造时存储在固件非易失内存 （非易失内存）。</span><span class="sxs-lookup"><span data-stu-id="f0083-127">These databases are generally stored on the firmware nonvolatile RAM (NV-RAM) at manufacturing time.</span></span> <span data-ttu-id="f0083-128">签名数据库 (db) 和已撤消的签名数据库 (dbx) 列表签名者或图像哈希的 UEFI 应用程序、 操作系统加载程序 （如 Microsoft 操作系统加载程序或启动管理器），并可以在设备加载的 UEFI 驱动程序以及为不再受信任和可能不会加载的项的已吊销映像。</span><span class="sxs-lookup"><span data-stu-id="f0083-128">The signature database (db) and the revoked signatures database (dbx) list the signers or image hashes of UEFI applications, operating system loaders (such as the Microsoft Operating System Loader or Boot Manager), and UEFI drivers that can be loaded on the device, as well as the revoked images for items that are no longer trusted and may not be loaded.</span></span> <span data-ttu-id="f0083-129">密钥注册密钥数据库 (KEK) 是一个单独的数据库的签名密钥可用于更新签名数据库和已撤消的签名数据库。</span><span class="sxs-lookup"><span data-stu-id="f0083-129">The Key Enrollment Key database (KEK) is a separate database of signing keys that can be used to update the signature database and revoked signatures database.</span></span> <span data-ttu-id="f0083-130">Microsoft 要求使用指定的项，以便 Microsoft 可以将新的操作系统添加到签名数据库或将已知错误图像添加到吊销的签名数据库将来要包含在 KEK 数据库中。</span><span class="sxs-lookup"><span data-stu-id="f0083-130">Microsoft requires a specified key to be included in the KEK database so that in the future Microsoft can add new operating systems to the signature database or add known bad images to the revoked signatures database.</span></span>

<span data-ttu-id="f0083-131">已添加这些数据库后，并最终固件验证和测试后，固件已锁定编辑，可以生成并添加平台键 (PK)。</span><span class="sxs-lookup"><span data-stu-id="f0083-131">After these databases have been added, and after final firmware validation and testing, firmware is locked from editing and a platform key (PK) can be generated and added.</span></span> <span data-ttu-id="f0083-132">PK 随后可用于登录到 KEK 的更新或对安全的变量进行任何所需的更改。</span><span class="sxs-lookup"><span data-stu-id="f0083-132">The PK can subsequently be used to sign updates to the KEK or make any desired changes to the secure variables.</span></span> 

<span data-ttu-id="f0083-133">设备构建者应联系其固件制造商，了解工具和创建这些数据库的帮助。</span><span class="sxs-lookup"><span data-stu-id="f0083-133">Device builders should contact their firmware manufacturer for tools and assistance in creating these databases.</span></span> <span data-ttu-id="f0083-134">请访问此[TechNet 文章](https://technet.microsoft.com/library/dn747883.aspx)详细了解安全启动密钥的创建和管理。</span><span class="sxs-lookup"><span data-stu-id="f0083-134">Visit this [TechNet article](https://technet.microsoft.com/library/dn747883.aspx) for more information about Secure Boot key creation and management.</span></span>

## <a name="implementing-tpms"></a><span data-ttu-id="f0083-135">实现 Tpm</span><span class="sxs-lookup"><span data-stu-id="f0083-135">Implementing TPMs</span></span>  
<span data-ttu-id="f0083-136">受信任的平台模块 (TPM) 是包括功能的随机数字生成、 安全的加密密钥的生成和限制其使用了加密协处理器。</span><span class="sxs-lookup"><span data-stu-id="f0083-136">A Trusted Platform Module (TPM) is a cryptographic coprocessor including capabilities for random number generation, secure generation of cryptographic keys and limitation of their use.</span></span> <span data-ttu-id="f0083-137">它还包括诸如远程证明和密封存储等功能。</span><span class="sxs-lookup"><span data-stu-id="f0083-137">It also includes capabilities such as remote attestation and sealed storage.</span></span> <span data-ttu-id="f0083-138">TPM 的技术规格是公开和调用受信任计算组 (TCG) 的标准正文由驱动。</span><span class="sxs-lookup"><span data-stu-id="f0083-138">TPM’s technical specification is publicly available and is driven by a standards body called the Trusted Computing Group (TCG).</span></span>  <span data-ttu-id="f0083-139">TPM 2.0 是可作为离散组件 （来自各个制造商） 以及在某些 Soc，在固件中实现。</span><span class="sxs-lookup"><span data-stu-id="f0083-139">TPM 2.0 is available as a discrete component (from various manufacturers) as well as within some SOCs, implemented in firmware.</span></span>

<span data-ttu-id="f0083-140">合并了 TPM 的设备可以创建加密密钥并加密，以便只能由 TPM 进行解密。</span><span class="sxs-lookup"><span data-stu-id="f0083-140">Devices that incorporate a TPM can create cryptographic keys and encrypt them so that they can only be decrypted by the TPM.</span></span> <span data-ttu-id="f0083-141">此过程中，通常称为"包装"绑定"密钥，可以帮助避免泄露的密钥。</span><span class="sxs-lookup"><span data-stu-id="f0083-141">This process, often called "wrapping" or "binding" a key, can help protect the key from disclosure.</span></span> <span data-ttu-id="f0083-142">每个 TPM 有一个主"覆盖"密钥，名为存储根密钥 (SRK)，它存储在 TPM 的内部。</span><span class="sxs-lookup"><span data-stu-id="f0083-142">Each TPM has a master "wrapping" key, called the storage root key (SRK), which is stored within the TPM itself.</span></span> <span data-ttu-id="f0083-143">TPM 中创建的密钥的私钥部分永远不会公开给任何其他组件、软件、进程或用户。</span><span class="sxs-lookup"><span data-stu-id="f0083-143">The private portion of a key created in a TPM is never exposed to any other component, software, process, or person.</span></span> <span data-ttu-id="f0083-144">此外，合并了 TPM 的设备还可以创建一个键，它不仅被覆盖，而且还被连接到特定平台度量。</span><span class="sxs-lookup"><span data-stu-id="f0083-144">Furthermore, devices that incorporate a TPM can also create a key that has not only been wrapped but is also tied to certain platform measurements.</span></span> <span data-ttu-id="f0083-145">仅当这些平台测量具有的值与创建该密钥时所具有的值相同时，才可以解封此类型的密钥。</span><span class="sxs-lookup"><span data-stu-id="f0083-145">This type of key can only be unwrapped when those platform measurements have the same values that they had when the key was created.</span></span> <span data-ttu-id="f0083-146">此过程称为"密封"到 TPM，密钥时解密该密钥称作"解封"。</span><span class="sxs-lookup"><span data-stu-id="f0083-146">This process is called "sealing" the key to the TPM, while decrypting the key is called "unsealing".</span></span> <span data-ttu-id="f0083-147">TPM 还可以对 TPM 外部生成的数据进行封装和解封。</span><span class="sxs-lookup"><span data-stu-id="f0083-147">The TPM can also seal and unseal data generated outside of the TPM.</span></span> <span data-ttu-id="f0083-148">使用此封装的密钥和软件（例如 BitLocker 驱动器加密），可以锁定数据，直到符合特定的硬件或软件条件为止。</span><span class="sxs-lookup"><span data-stu-id="f0083-148">With this sealed key and software such as BitLocker Drive Encryption, you can lock data until specific hardware or software conditions are met.</span></span> 

<span data-ttu-id="f0083-149">借助 TPM，可保持密钥对的私钥部分独立于操作系统控制的内存。</span><span class="sxs-lookup"><span data-stu-id="f0083-149">With a TPM, private portions of key pairs are kept separate from the memory controlled by the operating system.</span></span> <span data-ttu-id="f0083-150">可以将密钥封装到 TPM，并且在解封并释放该密钥以供使用之前，可以就系统的状态（定义系统”可信赖”的保证）提供某些保证。</span><span class="sxs-lookup"><span data-stu-id="f0083-150">Keys can be sealed to the TPM, and certain assurances about the state of a system (assurances that define the "trustworthiness" of a system) can be made before the keys are unsealed and released for use.</span></span> <span data-ttu-id="f0083-151">由于 TPM 使用自己的内部固件和逻辑电路来处理指令，因此它不依赖于操作系统，并且它不会公开给操作系统或应用程序软件中可能存在的安全漏洞。</span><span class="sxs-lookup"><span data-stu-id="f0083-151">Because the TPM uses its own internal firmware and logic circuits for processing instructions, it does not rely on the operating system and is not exposed to vulnerabilities that might exist in the operating system or application software.</span></span>

> [!NOTE] 
> <span data-ttu-id="f0083-152">尽管某些设备可能会合并较旧的 TPM 1.2 芯片，Windows 10 IoT 核心版仅支持 TPM 2.0。</span><span class="sxs-lookup"><span data-stu-id="f0083-152">Though some devices may incorporate an older TPM 1.2 chip, Windows 10 IoT Core only supports TPM 2.0.</span></span>

## <a name="enabling-bitlocker-encryption"></a><span data-ttu-id="f0083-153">启用 BitLocker 加密</span><span class="sxs-lookup"><span data-stu-id="f0083-153">Enabling BitLocker Encryption</span></span>  
<span data-ttu-id="f0083-154">为了保护数据的其余部分 （即存储在设备上的日期），Microsoft 为 Windows 10 IoT 核心版中的 IoT 设备引入其企业级 BitLocker 驱动器加密技术。</span><span class="sxs-lookup"><span data-stu-id="f0083-154">In order to protect data at rest (i.e. date stored on a device), Microsoft brought its enterprise-grade BitLocker Drive Encryption technology to IoT devices in Windows 10 IoT Core.</span></span>  <span data-ttu-id="f0083-155">BitLocker 可确保在设备上存储的数据仍然保持加密，即使设备未运行操作系统时被篡改。</span><span class="sxs-lookup"><span data-stu-id="f0083-155">BitLocker ensures that data stored on a device remains encrypted, even if the device is tampered with while the OS is not running.</span></span>  <span data-ttu-id="f0083-156">这有助于防范"脱机攻击"，所做的禁用或绕过已的安装的操作系统，或通过从设备在物理上分隔的存储媒体，以便单独攻击数据所做的攻击。</span><span class="sxs-lookup"><span data-stu-id="f0083-156">This helps protect against "offline attacks", attacks made by disabling or circumventing the installed operating system, or made by physically separating the storage media from the device in order to attack the data separately.</span></span> 

<span data-ttu-id="f0083-157">BitLocker 使用受信任的平台模块 (TPM) 来提供增强的保护，为你的数据，并确保早期启动组件的完整性。</span><span class="sxs-lookup"><span data-stu-id="f0083-157">BitLocker uses a Trusted Platform Module (TPM) to provide enhanced protection for your data and to assure early boot component integrity.</span></span> <span data-ttu-id="f0083-158">这有助于防止数据被盗或未经授权的查看通过加密整个 Windows 卷和任何可能会出现在设备上的数据分区。</span><span class="sxs-lookup"><span data-stu-id="f0083-158">This helps protect your data from theft or unauthorized viewing by encrypting the entire Windows volume and any data partitions that might be present on your device.</span></span>

<span data-ttu-id="f0083-159">有关如何启用 Windows 10 IoT Core 上的 BitLocker 的其他说明，请遵循所述的步骤[此处](https://docs.microsoft.com/en-us/windows/iot-core/secure-your-device/securebootandbitlocker)。</span><span class="sxs-lookup"><span data-stu-id="f0083-159">For additional instructions on how to enable BitLocker on Windows 10 IoT Core, follow the steps outlined [here](https://docs.microsoft.com/en-us/windows/iot-core/secure-your-device/securebootandbitlocker).</span></span>

## <a name="onboard-storage-options"></a><span data-ttu-id="f0083-160">载入存储选项</span><span class="sxs-lookup"><span data-stu-id="f0083-160">Onboard Storage Options</span></span>
<span data-ttu-id="f0083-161">开发板，如常用的 Raspberry Pi 3，提供的灵活性，并允许开发人员能够轻松地启动任何平台通过可移动的 SD 卡。</span><span class="sxs-lookup"><span data-stu-id="f0083-161">Development boards, like the popular Raspberry Pi 3, offer flexibility and allow developers to easily boot any platform via a removable SD card.</span></span>  <span data-ttu-id="f0083-162">适用于大多数行业 IoT 设备，这种灵活性是不可取的并可以使此类设备的攻击容易实现的目标。</span><span class="sxs-lookup"><span data-stu-id="f0083-162">For most industry IoT devices, such flexibility is not desirable and can make such devices an easy target for attacks.</span></span> <span data-ttu-id="f0083-163">相反，在设计时您的硬件，请考虑对较小的、 低成本 IoT 设备使用 eMMC 存储。</span><span class="sxs-lookup"><span data-stu-id="f0083-163">Instead, when designing your hardware, consider using an eMMC storage for your smaller, low cost IoT devices.</span></span>  <span data-ttu-id="f0083-164">嵌入的存储可以大大增强其难度单独从设备的内容并反过来，降低了引入恶意软件到设备或数据被盗的可能性。</span><span class="sxs-lookup"><span data-stu-id="f0083-164">Embedded storage makes it significantly more difficult to separate the content from the device and in turn, reduces the potential of introducing malware onto the device or data theft.</span></span> 

## <a name="developer-tools"></a><span data-ttu-id="f0083-165">开发人员工具</span><span class="sxs-lookup"><span data-stu-id="f0083-165">Developer Tools</span></span>  
<span data-ttu-id="f0083-166">构建 Windows 10 IoT 核心版映像最终传送设备时使用 ICD （映像配置设计器），确保没有开发人员工具包括在零售映像。</span><span class="sxs-lookup"><span data-stu-id="f0083-166">When building your Windows 10 IoT Core image final shipping device using ICD (Image Configuration Designer), ensure that no developer tools are included in your retail image.</span></span>  <span data-ttu-id="f0083-167">这些可能可以打开您的设备与攻击工具，开发人员可以远程访问和调试 IoT Core 设备不应在生产系统上存在。</span><span class="sxs-lookup"><span data-stu-id="f0083-167">Tools that allows developers to remotely access and debug IoT Core devices should not be present on production systems as these can potentially open up your device to attacks.</span></span>  <span data-ttu-id="f0083-168">请确保我们的开发人员工具等 Windows Device Portal，ftp 服务器、 SSH 或 PowerShell 中使用你的映像在开发期间，如果你测试和验证的零售映像 IoT Core 上您不包括这些工具的方案。</span><span class="sxs-lookup"><span data-stu-id="f0083-168">Make sure that if you're using our developer tools like Windows Device Portal, ftp server, SSH, or PowerShell in your images during development, that you test and validate your scenarios on retail IoT Core images that do not include these tools.</span></span>

## <a name="user-accounts"></a><span data-ttu-id="f0083-169">用户帐户</span><span class="sxs-lookup"><span data-stu-id="f0083-169">User Accounts</span></span>  
<span data-ttu-id="f0083-170">大多数用户都熟悉这一概念时取消装箱并设置凭据来访问设备执行"所有权"的电脑和手机的想法之类的设备的个性化设置设备。</span><span class="sxs-lookup"><span data-stu-id="f0083-170">Most users are familiar with the notion of taking "ownership" of devices like PCs and phones - the idea of personalizing the device when unboxed and setting up credentials to access the device.</span></span> <span data-ttu-id="f0083-171">与不同的使用者电脑和手机，IoT 设备不应作为常规用途计算设备。</span><span class="sxs-lookup"><span data-stu-id="f0083-171">Unlike consumer PCs and phones, IoT devices are not intended to serve as general purpose computing devices.</span></span> <span data-ttu-id="f0083-172">相反，它们是通常的单应用、 固定用途设备。</span><span class="sxs-lookup"><span data-stu-id="f0083-172">Instead, they are usually single-app, fixed purpose devices.</span></span> <span data-ttu-id="f0083-173">尽管 Windows 支持可以远程连接到设备在开发周期内的设备管理员的概念，工业 IoT 设备上的此类支持可能会带来威胁，尤其是在使用弱密码。</span><span class="sxs-lookup"><span data-stu-id="f0083-173">Though Windows supports the notion of device administrators that can remotely connect to devices during a development cycle, such support on industry IoT devices can pose a threat, especially when weak passwords are used.</span></span>  <span data-ttu-id="f0083-174">一般情况下，Microsoft 建议，应在 Windows 10 IoT Core 设备上创建没有"default"帐户或密码。</span><span class="sxs-lookup"><span data-stu-id="f0083-174">In general, Microsoft recommends that no "default" accounts or passwords should be created on Windows 10 IoT Core devices.</span></span>


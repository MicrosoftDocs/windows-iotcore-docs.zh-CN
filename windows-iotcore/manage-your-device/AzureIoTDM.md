---
title: Azure IoT 设备管理
author: saraclay
ms.author: saclayt
ms.date: 08/28/2017
ms.topic: article
description: 了解如何使用 Azure IoT 设备管理和 Windows IoT 来管理设备。
keywords: windows iot, Azure IoT, Azure 设备管理, 设备管理
ms.openlocfilehash: 51580c2ca4c5bf653428ed83e0d6d53310ae89a3
ms.sourcegitcommit: b00cd20ca22e63b3d0795a1b8fe248963b3c74ed
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/28/2019
ms.locfileid: "67467120"
---
# <a name="azure-iot-device-management"></a><span data-ttu-id="2c7b4-104">Azure IoT 设备管理</span><span class="sxs-lookup"><span data-stu-id="2c7b4-104">Azure IoT Device Management</span></span>   

<span data-ttu-id="2c7b4-105">当涉及到连接的设备时, 远程设备管理是系统操作员使用的主要功能之一。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-105">When it comes to connected devices, remote device management is one of the key features used by system operators.</span></span> <span data-ttu-id="2c7b4-106">它使操作员能够远程重新配置和更新设备的软件和参数, 而无需对设备进行本地物理访问。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-106">It enables operators to reconfigure and update software and parameters of the device remotely without the need to have local, physical access to the device.</span></span> <span data-ttu-id="2c7b4-107">通过 Windows 10 IoT Core, Oem 可以构建提供这些功能的设备。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-107">With Windows 10 IoT Core, OEMs can build devices that offer these capabilities out-of-the box.</span></span> <span data-ttu-id="2c7b4-108">Windows 10 IoT Core 以及其他 Windows 10 版本已经基于[OMA DM](https://en.wikipedia.org/wiki/OMA_Device_Management)提供了移动设备管理 (MDM)。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-108">Windows 10 IoT Core, as well as other Windows 10 versions, already offers Mobile Device Management (MDM) based on [OMA DM](https://en.wikipedia.org/wiki/OMA_Device_Management).</span></span> <span data-ttu-id="2c7b4-109">这主要用于使用 SCCM 或 Intune 等管理工具的企业解决方案。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-109">This is mainly utilized in enterprise solutions with management tools such as SCCM or Intune.</span></span> <span data-ttu-id="2c7b4-110">尽管这些解决方案非常适合于处于企业设置中的设备, 但在 IoT 解决方案中看到的更多样化的设置中会出现问题。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-110">While those solutions are well suited for devices placed in an enterprise setting, it has challenges in the more diverse settings that we see in IoT solutions.</span></span> <span data-ttu-id="2c7b4-111">还会在需要轻型设备管理的 IoT 设备中了解这些挑战。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-111">Those challenges are also seen in IoT devices requiring light weight device management.</span></span> <span data-ttu-id="2c7b4-112">对于这些设备, Microsoft[通过 Azure IoT 中心提供设备管理](https://docs.microsoft.com/azure/iot-hub/iot-hub-device-management-overview)。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-112">For those devices, Microsoft offers [device management through Azure IoT Hub](https://docs.microsoft.com/azure/iot-hub/iot-hub-device-management-overview).</span></span>    

## <a name="scalable-device-management-with-windows-iot"></a><span data-ttu-id="2c7b4-113">Windows IoT 的可伸缩设备管理</span><span class="sxs-lookup"><span data-stu-id="2c7b4-113">Scalable device management with Windows IoT</span></span>  

<span data-ttu-id="2c7b4-114">使用在家庭设备、HVAC 系统等设备中运行的 Windows IoT Core, 需要可自定义的轻型设备管理解决方案。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-114">With Windows IoT Core running in devices such as home appliances, HVAC systems and others, there is a need for a customizable, light weight device management solution.</span></span> <span data-ttu-id="2c7b4-115">在 Windows Creator 版本中, Microsoft 启用了[Azure IoT 中心设备管理](https://docs.microsoft.com/azure/iot-hub/iot-hub-device-management-overview)。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-115">In the Windows Creator Edition, Microsoft enables [Azure IoT Hub device management](https://docs.microsoft.com/azure/iot-hub/iot-hub-device-management-overview).</span></span> <span data-ttu-id="2c7b4-116">Oem 可以使用[Windows IoT AZURE DM 客户端库](https://aka.ms/iot-core-azure-dm-client)将设备管理功能添加到其 Azure IoT 中心连接的设备上。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-116">OEMs can use the [Windows IoT Azure DM client library](https://aka.ms/iot-core-azure-dm-client) to add device management capabilities to their Azure IoT hub connected devices.</span></span> <span data-ttu-id="2c7b4-117">此库将访问标准 Windows 设备管理组件 ([配置服务提供程序](https://msdn.microsoft.com/windows/hardware/commercialize/customize/mdm/configuration-service-provider-reference)、CSP)。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-117">This library will access the standard Windows device management components ([Configuration Service Providers](https://msdn.microsoft.com/windows/hardware/commercialize/customize/mdm/configuration-service-provider-reference), CSP).</span></span>  <span data-ttu-id="2c7b4-118">现在, Oem 可以构建支持 SCCM、Intune 和 Azure IoT 中心进行设备管理的设备, 并使其客户能够选择最适合的类型 DM 解决方案。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-118">OEMs can now build devices that support SCCM, Intune and Azure IoT Hub for device management and leave it up to their customers to select the type DM solution that fits them best.</span></span>   

![Azure IoT 中心设备管理](../media/AzureIoTDM/azureDM.png) 

## <a name="how-does-it-work"></a><span data-ttu-id="2c7b4-120">如何运作？</span><span class="sxs-lookup"><span data-stu-id="2c7b4-120">How does it work?</span></span>    

<span data-ttu-id="2c7b4-121">[Windows IoT AZURE DM 客户端库](https://aka.ms/iot-core-azure-dm-client)链接在主机应用程序中。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-121">The [Windows IoT Azure DM client library](https://aka.ms/iot-core-azure-dm-client) is linked in the host application.</span></span> <span data-ttu-id="2c7b4-122">它与主机应用程序共享 Azure IoT 中心连接。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-122">It shares the Azure IoT Hub connection with the host app.</span></span> <span data-ttu-id="2c7b4-123">这样就可以进行额外的注册, 以实现不必要的设备管理。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-123">Thus making additional enrollment to enable device management unnecessary.</span></span> <span data-ttu-id="2c7b4-124">下图显示了使用 Windows IoT Azure DM 客户端库的 Azure IoT 中心 DM 解决方案的体系结构。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-124">The picture below shows the architecture for an Azure IoT Hub DM solution using the Windows IoT Azure DM client library.</span></span>     

![Azure DM 流程图](../media/AzureIoTDM/AzureDM-Architecture.png)    

<span data-ttu-id="2c7b4-126">Microsoft 提供了两个系统组件: CommProxy 和 SystemConfigurator, OEM 需要在设备映像中包含这些组件。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-126">Microsoft provides two system components, CommProxy.exe and SystemConfigurator.exe, which the OEM needs to include in the device image.</span></span> <span data-ttu-id="2c7b4-127">这些组件允许访问 Csp。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-127">These components give access to the CSPs.</span></span> <span data-ttu-id="2c7b4-128">IoTDMClientLib 将 CSP 接口映射到可由 Azure IoT 中心设备管理使用的函数。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-128">The IoTDMClientLib maps the CSP interface to functions that can be consumed by Azure IoT Hub device management.</span></span> <span data-ttu-id="2c7b4-129">它还提供了不使用 CSP 的 DM 函数, 例如设置时区。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-129">It also provides DM functions that don’t use a CSP, e.g. set time zone.</span></span> <span data-ttu-id="2c7b4-130">IoTDMClientLib 作为开源组件提供。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-130">The IoTDMClientLib is provided as an open source component.</span></span> <span data-ttu-id="2c7b4-131">Oem 可以对其进行扩展, 以添加特定于其设备的 DM 功能, 如传感器或传动装置的配置。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-131">OEMs can extend it to add DM capabilities that are specific to their device such as configurations for sensors or actuators.</span></span>  

## <a name="device-health-attestation"></a><span data-ttu-id="2c7b4-132">设备运行状况证明</span><span class="sxs-lookup"><span data-stu-id="2c7b4-132">Device Health Attestation</span></span>    
<span data-ttu-id="2c7b4-133">对于 IoT 设备的安全操作, 评估设备是否启动到受信任且合规的状态至关重要。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-133">For a secure operation of IoT devices it is essential to assess if a device is booted to a trusted and compliant state.</span></span> <span data-ttu-id="2c7b4-134">使用[Windows IoT 设备运行状况证明 (DHA)](https://github.com/ms-iot/iot-core-azure-dm-client/blob/master/docs/device-health-attestation.md)操作员可以验证设备的安全状态, 并根据需要通过[Azure IoT 中心设备管理](https://github.com/ms-iot/iot-core-azure-dm-client/blob/master/README.md)采取适当的补救措施。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-134">With [Windows IoT Device Health Attestation (DHA)](https://github.com/ms-iot/iot-core-azure-dm-client/blob/master/docs/device-health-attestation.md) operators can verify the secure state of a device, and take appropriate remedial actions if necessary through [Azure IoT Hub Device Management](https://github.com/ms-iot/iot-core-azure-dm-client/blob/master/README.md).</span></span> <span data-ttu-id="2c7b4-135">DHA 是 Windows IoT 核心 Azure 设备管理客户端的一部分。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-135">DHA is part of the Windows IoT Core Azure Device Management Client.</span></span> <span data-ttu-id="2c7b4-136">若要在解决方案中使用 DHA 功能, 需要访问 Microsoft DHA 服务。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-136">To use the DHA capability in your solution it requires access to the Microsoft DHA service.</span></span> <span data-ttu-id="2c7b4-137">可以通过[Windows 10 IoT Core Services](https://docs.microsoft.com/windows-hardware/manufacture/iot/iotcoreservicesoverview)获取对服务的订阅。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-137">A subscription to the service is available through the [Windows 10 IoT Core Services](https://docs.microsoft.com/windows-hardware/manufacture/iot/iotcoreservicesoverview).</span></span> 

### <a name="reference"></a><span data-ttu-id="2c7b4-138">参考</span><span class="sxs-lookup"><span data-stu-id="2c7b4-138">Reference</span></span>   
[<span data-ttu-id="2c7b4-139">Azure IoT DM 的设备运行状况证明</span><span class="sxs-lookup"><span data-stu-id="2c7b4-139">Device Health Attestation for Azure IoT DM</span></span>](https://github.com/ms-iot/iot-core-azure-dm-client/blob/master/docs/device-health-attestation.md)  

[<span data-ttu-id="2c7b4-140">部署设备运行状况证明的 Azure 资源</span><span class="sxs-lookup"><span data-stu-id="2c7b4-140">Deploy Azure Resources for Device Health Attestation</span></span>](https://github.com/ms-iot/iot-core-azure-dm-client/blob/master/docs/dha-deploy.md#deploy-azure-resources-for-device-health-attestation)  


## <a name="how-to-get-started"></a><span data-ttu-id="2c7b4-141">如何开始？</span><span class="sxs-lookup"><span data-stu-id="2c7b4-141">How to get started?</span></span>  

<span data-ttu-id="2c7b4-142">GitHub 上提供了 Windows IoT Azure DM 客户端库。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-142">Windows IoT Azure DM client library is available on GitHub.</span></span> <span data-ttu-id="2c7b4-143">它还包含 IoTDMClientLib 项目旁边的示例来快速入门。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-143">Beside the IoTDMClientLib project it also includes samples to get started quickly.</span></span> <span data-ttu-id="2c7b4-144">有关详细信息, 请参阅下面的链接。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-144">For more information see the links below.</span></span>    

### <a name="project-github-page"></a><span data-ttu-id="2c7b4-145">项目 GitHub 页</span><span class="sxs-lookup"><span data-stu-id="2c7b4-145">Project GitHub page</span></span> 

<span data-ttu-id="2c7b4-146">GitHub 上提供了[Windows IoT AZURE DM 客户端库](https://aka.ms/iot-core-azure-dm-client)。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-146">[Windows IoT Azure DM client library](https://aka.ms/iot-core-azure-dm-client) is available on GitHub.</span></span>  

### <a name="dm-dashboard"></a><span data-ttu-id="2c7b4-147">DM 仪表板</span><span class="sxs-lookup"><span data-stu-id="2c7b4-147">DM Dashboard</span></span>    

<span data-ttu-id="2c7b4-148">[Dm 仪表板](https://aka.ms/iot-core-azure-dm-client-dashboard)是用于测试设备上的 DM 函数的应用程序。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-148">[DM Dashboard](https://aka.ms/iot-core-azure-dm-client-dashboard) is an application to test the DM function on a device.</span></span> <span data-ttu-id="2c7b4-149">应用通过 Azure IoT 中心连接到设备。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-149">The app connects to the device via Azure IoT Hub.</span></span> <span data-ttu-id="2c7b4-150">应用可用于验证设备的 DM 功能。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-150">The app can be used to validate the DM capabilities of the device.</span></span> <span data-ttu-id="2c7b4-151">可对其进行扩展, 以测试已添加到 IoTDMClientLib 的任何第三方 DM 函数。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-151">It can be extended to test any third-party DM functions that were added to the IoTDMClientLib.</span></span>    

### <a name="dm-background-application"></a><span data-ttu-id="2c7b4-152">DM 后台应用程序</span><span class="sxs-lookup"><span data-stu-id="2c7b4-152">DM background application</span></span>   

<span data-ttu-id="2c7b4-153">[DM 后台应用程序](https://aka.ms/iot-core-azure-dm-client-backgroundapp)演示如何在连接到 Azure iot 中心的应用程序中使用 IoTDMClientLib, 并需要在 Windows IoT Core 上以后台应用的形式运行。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-153">The [DM background application](https://aka.ms/iot-core-azure-dm-client-backgroundapp) shows how the IoTDMClientLib can be used in an application that connects to Azure IoT Hub and needs to run as background app on Windows IoT Core.</span></span>    

### <a name="toaster-application"></a><span data-ttu-id="2c7b4-154">Toaster 应用程序</span><span class="sxs-lookup"><span data-stu-id="2c7b4-154">Toaster Application</span></span> 

<span data-ttu-id="2c7b4-155">作为上述设备管理后台应用的[Toaster 应用程序](https://aka.ms/iot-core-azure-dm-client-toasterapp)将为设备启用 Azure DM 功能。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-155">The [Toaster application](https://aka.ms/iot-core-azure-dm-client-toasterapp), as the device management background app above, will enable Azure DM capabilities for a device.</span></span> <span data-ttu-id="2c7b4-156">此应用将在前台运行, 并允许通过设备 UI 访问 DM 参数和功能。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-156">This app will run in the foreground and allow access to DM parameters and functions via the devices UI.</span></span>   

### <a name="registering-your-device-with-the-azure-device-provision-service-dps"></a><span data-ttu-id="2c7b4-157">将设备注册到 Azure 设备预配服务 (DPS)</span><span class="sxs-lookup"><span data-stu-id="2c7b4-157">Registering your device with the Azure Device Provision Service (DPS)</span></span>   

<span data-ttu-id="2c7b4-158">使用 Azure 设备预配服务, 客户可以自动将设备与 IoT 中心后期生产进行关联和配置。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-158">The Azure Device Provisioning Service allows customers to automatically associate and configure a device with an IoT Hub post-production.</span></span> <span data-ttu-id="2c7b4-159">对于此过程, 设备预配服务将需要一个唯一的 challengeable 设备 ID, 以帮助在设备进入操作时安全地配置设备。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-159">For this process Device Provisioning Service will need a unique and challengeable device ID to help configure the device securely when the device is put in operation.</span></span> <span data-ttu-id="2c7b4-160">设备预配服务使用 TPM 的公共认可密钥 (EKeyPub) 来实现此目的。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-160">Device Provisioning Service uses the TPM’s public Endorsement Key (EKeyPub) for this purpose.</span></span> <span data-ttu-id="2c7b4-161">若要向 DPS 注册设备, 需要从设备搜集 EKeyPub。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-161">To register the device with DPS, the EKeyPub needs to be harvested from the device.</span></span> <span data-ttu-id="2c7b4-162">此步骤的首选时间是在生产期间 (在设备的行尾测试过程中)。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-162">The preferred time for this step is during production (during end-of-line testing of the device).</span></span> <span data-ttu-id="2c7b4-163">不过, 如果需要, 也可以在生产后执行此过程。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-163">However, the process can also be done post-production if needed.</span></span>   

<span data-ttu-id="2c7b4-164">Microsoft 提供了 Limpet 工具来简化设备预配服务注册过程。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-164">Microsoft provides the Limpet tool to streamline the Device Provisioning Service registration process.</span></span> <span data-ttu-id="2c7b4-165">根据制造设置, 如果有可用的联机连接, 则可以使用 Limpet 直接注册设备, 也可以使用设备预配服务直接注册设备, Limpet 可以获取 EKeyPub, 以便以后脱机注册设备正在预配服务。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-165">Depending on your manufacturing setup, if there is an online connection available, the device can be registered using Limpet directly with Device Provisioning Service, or Limpet can harvest the EKeyPub for a later, offline registration of the device with Device Provisioning Service.</span></span>  

<span data-ttu-id="2c7b4-166">有关 Limpet 的设备预配服务注册过程的更多详细信息, 请参阅[Limpet 文档](https://github.com/ms-iot/azure-dm-client/blob/master/docs/limpet.md)中的在[设备预配服务中注册设备](https://github.com/ms-iot/azure-dm-client/blob/master/docs/limpet.md#setup-azure-cloud-resources)部分。</span><span class="sxs-lookup"><span data-stu-id="2c7b4-166">For more details on the Device Provisioning Service registration process with Limpet, see the [Enroll the device in Device Provisioning Service](https://github.com/ms-iot/azure-dm-client/blob/master/docs/limpet.md#setup-azure-cloud-resources)  section in the [Limpet documentation](https://github.com/ms-iot/azure-dm-client/blob/master/docs/limpet.md).</span></span>    

<span data-ttu-id="2c7b4-167">项目存储库:[Limpet 项目存储库](https://github.com/ms-iot/azure-dm-client/)</span><span class="sxs-lookup"><span data-stu-id="2c7b4-167">Project repository: [Limpet project repository](https://github.com/ms-iot/azure-dm-client/)</span></span>     


<span data-ttu-id="2c7b4-168">许可证Limpet 在 MIT 开源许可证下许可</span><span class="sxs-lookup"><span data-stu-id="2c7b4-168">License: Limpet is licensed under the MIT open source license</span></span>   


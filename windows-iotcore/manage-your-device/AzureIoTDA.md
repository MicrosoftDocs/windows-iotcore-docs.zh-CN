---
title: Azure IoT 设备代理
author: rcheeran
ms.author: rcheeran
ms.date: 06/25/2019
ms.topic: article
ms.prod: windows-iot
ms.technology: iot
description: 了解如何使用 Windows IoT 上的 Azure IoT 设备代理管理设备。
keywords: windows iot，Azure IoT，Azure 设备代理，设备管理，远程管理
ms.openlocfilehash: 7f2137be065a6ceab781a9276acba4a62f707a3c
ms.sourcegitcommit: c57cebdf4d083079f41ec92ef65d897fd3c0faf8
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/02/2020
ms.locfileid: "91655493"
---
# <a name="azure-iot-device-agent"></a><span data-ttu-id="39a24-104">Azure IoT 设备代理</span><span class="sxs-lookup"><span data-stu-id="39a24-104">Azure IoT Device Agent</span></span>

<span data-ttu-id="39a24-105">当涉及到连接的设备时，远程设备管理是系统操作员所需的主要功能之一。</span><span class="sxs-lookup"><span data-stu-id="39a24-105">When it comes to connected devices, remote device management is one of the key features that system operators need.</span></span> <span data-ttu-id="39a24-106">它使操作员能够远程配置属性和更新设备上的软件，而无需对设备进行本地或物理访问。</span><span class="sxs-lookup"><span data-stu-id="39a24-106">It enables operators to configure properties and update software on the device remotely, without the need to have local or physical access to the device.</span></span> <span data-ttu-id="39a24-107">使用在家庭设备、HVAC 系统等设备上运行的 Windows IoT Core 和 Windows IoT Enterprise，需要可自定义的轻型设备管理解决方案。</span><span class="sxs-lookup"><span data-stu-id="39a24-107">With Windows IoT Core and Windows IoT Enterprise running on devices such as home appliances, HVAC systems and others, there is a need for a customizable, lightweight device management solution.</span></span> <span data-ttu-id="39a24-108">虽然 Windows 10 版本已经提供基于 [OMA DM](https://en.wikipedia.org/wiki/OMA_Device_Management) (MDM) 的移动设备管理，但这主要用于使用 SCCM 或 Intune 等管理工具的企业解决方案。</span><span class="sxs-lookup"><span data-stu-id="39a24-108">While Windows 10 versions already offer Mobile Device Management (MDM) based on [OMA DM](https://en.wikipedia.org/wiki/OMA_Device_Management), this is mainly utilized in enterprise solutions with management tools such as SCCM or Intune.</span></span> <span data-ttu-id="39a24-109">尽管这些解决方案非常适合于处于企业设置中的设备，但在 IoT 解决方案中看到的更多样化的设置中会出现问题。</span><span class="sxs-lookup"><span data-stu-id="39a24-109">While those solutions are well suited for devices placed in an enterprise setting, it has challenges in the more diverse settings that we see in IoT solutions.</span></span> <span data-ttu-id="39a24-110">IoT 设备还需要轻型、小型设备管理解决方案，这可能是一项挑战。</span><span class="sxs-lookup"><span data-stu-id="39a24-110">IoT devices also require a lightweight, small footprint device management solution, which can be a challenge.</span></span> <span data-ttu-id="39a24-111">Microsoft 还提供了使用 [Azure IoT 中心](https://docs.microsoft.com/azure/iot-hub/iot-hub-device-management-overview) 及其 [SDK](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-sdks)的设备管理功能。 [Azure IoT 设备代理](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/device-agent.md) 同时提供这两项功能：云中的设备管理功能通过 IoT 中心，可与相同的标准 [配置服务提供程序 (CSP) ](https://docs.microsoft.com/windows/client-management/mdm/configuration-service-provider-reference) ，与移动设备管理使用的相同。</span><span class="sxs-lookup"><span data-stu-id="39a24-111">Microsoft also offers device management capabilities using [Azure IoT Hub](https://docs.microsoft.com/azure/iot-hub/iot-hub-device-management-overview) and its [SDK](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-sdks).The [Azure IoT Device Agent](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/device-agent.md) brings both these capabilities together: device management capabilities in the cloud via the IoT Hub, which works with the same standard [Configuration Service Providers(CSP)](https://docs.microsoft.com/windows/client-management/mdm/configuration-service-provider-reference) as used by Mobile Device Management.</span></span> <span data-ttu-id="39a24-112">借助 Azure 设备代理，Oem 可以构建提供这些设备管理功能的设备，而无需编写任何代码。</span><span class="sxs-lookup"><span data-stu-id="39a24-112">With the Azure Device Agent, OEMs can build devices that offer these device management capabilities without writing any code.</span></span>

<span data-ttu-id="39a24-113">Azure 设备代理是一种可用于启用远程设备管理功能的现成的开放源包。</span><span class="sxs-lookup"><span data-stu-id="39a24-113">The Azure Device Agent is a ready-to-build open-source package that enables remote device management capabilities.</span></span> <span data-ttu-id="39a24-114">Windows 10 IoT Core 和 Windows 10 IoT Enterprise 支持 Azure 设备代理，并可在通过 IoT 中心连接的设备上运行。</span><span class="sxs-lookup"><span data-stu-id="39a24-114">The Azure Device Agent is supported on Windows 10 IoT Core and Windows 10 IoT Enterprise and works on devices connected via the IoT Hub.</span></span> <span data-ttu-id="39a24-115">现在，Oem 可以构建支持 SCCM、Intune 或 Azure IoT 中心进行设备管理的设备，并使其客户能够选择最适合的设备管理解决方案。</span><span class="sxs-lookup"><span data-stu-id="39a24-115">OEMs can now build devices that support SCCM, Intune, or Azure IoT Hub for device management and leave it up to their customers to select the device management solution that fits them best.</span></span>   

![Azure IoT 中心设备管理](../media/AzureIoTDM/azureDM.png)


## <a name="how-does-it-work"></a><span data-ttu-id="39a24-117">工作原理</span><span class="sxs-lookup"><span data-stu-id="39a24-117">How does it work?</span></span>

<span data-ttu-id="39a24-118">[Azure IoT 设备代理](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/device-agent.md)由两个核心组件组成。</span><span class="sxs-lookup"><span data-stu-id="39a24-118">The [Azure IoT Device Agent](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/device-agent.md) consists of two core components.</span></span> 

<span data-ttu-id="39a24-119">设备预配服务客户端 (DPS 客户端) 自动执行设备设置。</span><span class="sxs-lookup"><span data-stu-id="39a24-119">The Device Provisioning Service Client (DPS Client) automates device provisioning.</span></span> <span data-ttu-id="39a24-120">它通过设备的注册密钥和 DPS ScopeID 连接到 Azure 设备预配服务。</span><span class="sxs-lookup"><span data-stu-id="39a24-120">It connects to the Azure Device Provisioning Service with the device's Enrollment Key and DPS ScopeID.</span></span> <span data-ttu-id="39a24-121">Azure DPS 服务标识设备并在配置的 IoT 中心预配该设备，并将连接字符串返回到设备。</span><span class="sxs-lookup"><span data-stu-id="39a24-121">The Azure DPS service identifies the device and provisions it in the configured IoT Hub and returns a connection string back to the device.</span></span> <span data-ttu-id="39a24-122">然后，DPS 客户端使用此连接字符串将设备连接到正确的 IoT 中心。</span><span class="sxs-lookup"><span data-stu-id="39a24-122">The DPS client then uses this connection string to connect the device to the right IoT Hub.</span></span>  

<span data-ttu-id="39a24-123">设备管理客户端使用 [配置服务提供程序](https://msdn.microsoft.com/windows/hardware/commercialize/customize/mdm/configuration-service-provider-reference)启用远程设备管理功能，CSP) Azure 设备代理的远程管理功能支持插件模型，使你能够仅选择所需的功能。</span><span class="sxs-lookup"><span data-stu-id="39a24-123">The Device Management Client enables remote device management capabilities using the [Configuration Service Providers](https://msdn.microsoft.com/windows/hardware/commercialize/customize/mdm/configuration-service-provider-reference), CSP) The Azure Device Agent's remote management capabilities supports a plug-in model that allows you to select only the capabilities you need.</span></span> <span data-ttu-id="39a24-124">此外，插件体系结构可扩展。</span><span class="sxs-lookup"><span data-stu-id="39a24-124">In addition, the plug-in architecture is extendable.</span></span> <span data-ttu-id="39a24-125">你可以为所需的设备管理功能编写自己的插件，并将其添加到 Azure 设备代理。</span><span class="sxs-lookup"><span data-stu-id="39a24-125">You can write your own plug-in for a device management capability that you need and adds it to the Azure Device Agent.</span></span> <span data-ttu-id="39a24-126">所有设备管理功能都可以使用设备克隆或模块克隆属性和命令以远程方式进行访问，从而为所有 Windows IoT 设备启用单个窗格的管理方法。</span><span class="sxs-lookup"><span data-stu-id="39a24-126">All the device management capabilities are remotely accessible using the Device Twin or Module Twin properties and commands, thereby enabling a single-pane-of-glass management approach for all your Windows IoT devices.</span></span> <span data-ttu-id="39a24-127">有关可用设备管理功能的完整列表，请参阅 [此](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/reference.md)</span><span class="sxs-lookup"><span data-stu-id="39a24-127">For a complete list of device management capabilities available refer to [this](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/reference.md)</span></span>

<span data-ttu-id="39a24-128">除此之外，Azure 设备代理还会为设备上运行的其他 UWP 应用程序创建和管理 SAS 令牌。</span><span class="sxs-lookup"><span data-stu-id="39a24-128">In addition to this, the Azure Device Agent also creates and manages SAS tokens for other UWP applications running on the device.</span></span> <span data-ttu-id="39a24-129">Azure 设备代理可以将其他 UWP 应用预配为设备克隆或模块克隆，并将其连接字符串添加到各自的 TPM 槽。</span><span class="sxs-lookup"><span data-stu-id="39a24-129">The Azure Device Agent can provision other UWP apps as either a Device Twin or as a Module Twin and add their connection strings to the respective TPM slots.</span></span> <span data-ttu-id="39a24-130">UWP 应用利用 [Uwp 桥](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/uwp-bridge.md) 从 TPM 槽读取连接字符串，并可以使用它连接到 IoT 中心。</span><span class="sxs-lookup"><span data-stu-id="39a24-130">The UWP app leverages the [UWP Bridge](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/uwp-bridge.md) to read their connection string from the TPM slot and can use that to connect to the IoT Hub.</span></span>

## <a name="how-to-get-started"></a><span data-ttu-id="39a24-131">如何开始？</span><span class="sxs-lookup"><span data-stu-id="39a24-131">How to get started?</span></span>

<span data-ttu-id="39a24-132">GitHub 上提供了 Azure IoT 设备代理。</span><span class="sxs-lookup"><span data-stu-id="39a24-132">The Azure IoT Device Agent is available on GitHub.</span></span> <span data-ttu-id="39a24-133">该项目还包括快速入门的示例。</span><span class="sxs-lookup"><span data-stu-id="39a24-133">The project also includes samples to get started quickly.</span></span> <span data-ttu-id="39a24-134">有关详细信息，请查看我们的[GitHub 存储](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/device-agent.md)库</span><span class="sxs-lookup"><span data-stu-id="39a24-134">For more information, check out our GitHub [repo](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/device-agent.md)</span></span>

## <a name="migrating-from-azure-device-agent-v1-to-v2"></a><span data-ttu-id="39a24-135">从 Azure 设备代理 V1 迁移到 V2</span><span class="sxs-lookup"><span data-stu-id="39a24-135">Migrating from Azure Device Agent V1 to V2</span></span>
<span data-ttu-id="39a24-136">如果你当前使用的是 v1 版本的设备代理，则 V1 与 V2 之间的一个重大更改是在 V2 版本中，Azure 设备代理不再与 UWP 应用共享连接。</span><span class="sxs-lookup"><span data-stu-id="39a24-136">If you are currently using the v1 version of the Device Agent, one significant change between V1 and V2 is that in the V2 version, the Azure Device Agent no longer shares the connection with an UWP app.</span></span> <span data-ttu-id="39a24-137">通过对 IoT 中心的增强功能，现在可以让 UWP 应用和 Azure 设备代理具有独立的连接字符串，并且仍与 IoT 中心中的同一设备相关联。</span><span class="sxs-lookup"><span data-stu-id="39a24-137">With enhancements to the IoT Hub, you can now have both the UWP app and the Azure Device Agent have independent connection strings and still be associated with the same device in IoT Hub.</span></span> <span data-ttu-id="39a24-138">有关更多详细信息，请参阅 [此处](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/migration-from-old-client.md) 。</span><span class="sxs-lookup"><span data-stu-id="39a24-138">Refer [here](https://github.com/ms-iot/azure-client-tools/blob/master/docs/device-agent/migration-from-old-client.md) for more details.</span></span>

<span data-ttu-id="39a24-139">有关 Azure 设备代理 V1 的详细信息，请参阅 [此处](https://docs.microsoft.com/windows/iot-core/manage-your-device/azureiotdm)。</span><span class="sxs-lookup"><span data-stu-id="39a24-139">For more information on the Azure Device Agent V1, refer [here](https://docs.microsoft.com/windows/iot-core/manage-your-device/azureiotdm).</span></span>

## <a name="other-useful-tools"></a><span data-ttu-id="39a24-140">其他有用工具</span><span class="sxs-lookup"><span data-stu-id="39a24-140">Other Useful Tools</span></span>
### <a name="dm-mock-portal"></a><span data-ttu-id="39a24-141">DM 模拟门户</span><span class="sxs-lookup"><span data-stu-id="39a24-141">DM Mock Portal</span></span>
<span data-ttu-id="39a24-142">[DM 模拟门户](https://github.com/ms-iot/azure-client-tools/blob/master/docs/dm-mock-portal/dm-mock-portal.md) 是一个应用程序，可用于在单个设备上或在多个设备上使用 IoT 中心的自动设备管理功能设置设备克隆或模块克隆属性。</span><span class="sxs-lookup"><span data-stu-id="39a24-142">[DM Mock Portal](https://github.com/ms-iot/azure-client-tools/blob/master/docs/dm-mock-portal/dm-mock-portal.md) is an application that can be used to set Device Twin or Module Twin properties on an individual device or across multiple devices, using the IoT Hub’s Automatic Device Management capabilities.</span></span>

### <a name="tpm-tool---limpetexe"></a><span data-ttu-id="39a24-143">TPM 工具-Limpet.exe</span><span class="sxs-lookup"><span data-stu-id="39a24-143">TPM Tool - Limpet.exe</span></span>
<span data-ttu-id="39a24-144">使用 Azure 设备预配服务，客户可以自动将设备与 IoT 中心后期生产进行关联和配置。</span><span class="sxs-lookup"><span data-stu-id="39a24-144">The Azure Device Provisioning Service allows customers to automatically associate and configure a device with an IoT Hub post-production.</span></span> <span data-ttu-id="39a24-145">对于此过程，设备预配服务将需要一个唯一的 challengeable 设备 ID，以帮助在设备进入操作时安全地配置设备。</span><span class="sxs-lookup"><span data-stu-id="39a24-145">For this process, Device Provisioning Service will need a unique and challengeable device ID to help configure the device securely when the device is put in operation.</span></span> <span data-ttu-id="39a24-146">设备预配服务使用 TPM 的公共认可密钥 (EKeyPub) 以实现此目的。</span><span class="sxs-lookup"><span data-stu-id="39a24-146">Device Provisioning Service uses the TPM’s public Endorsement Key (EKeyPub) for this purpose.</span></span> <span data-ttu-id="39a24-147">若要向 DPS 注册设备，需要从设备搜集 EKeyPub。</span><span class="sxs-lookup"><span data-stu-id="39a24-147">To register the device with DPS, the EKeyPub needs to be harvested from the device.</span></span> <span data-ttu-id="39a24-148">此步骤的首选时间在设备) 的行尾测试期间 (。</span><span class="sxs-lookup"><span data-stu-id="39a24-148">The preferred time for this step is during production (during end-of-line testing of the device).</span></span> <span data-ttu-id="39a24-149">不过，如果需要，也可以在生产后执行此过程。</span><span class="sxs-lookup"><span data-stu-id="39a24-149">However, the process can also be done post-production if needed.</span></span>  

<span data-ttu-id="39a24-150">Microsoft 提供了 Limpet 工具来简化设备预配服务注册过程。</span><span class="sxs-lookup"><span data-stu-id="39a24-150">Microsoft provides the Limpet tool to streamline the Device Provisioning Service registration process.</span></span> <span data-ttu-id="39a24-151">根据制造设置，如果有可用的联机连接，则可以使用 Limpet 直接通过设备预配服务注册设备，也可以通过设备预配服务对设备进行脱机注册，从而获取 EKeyPub。</span><span class="sxs-lookup"><span data-stu-id="39a24-151">Depending on your manufacturing setup, if there is an online connection available, the device can be registered using Limpet directly with Device Provisioning Service, or Limpet can harvest the EKeyPub for a later, offline registration of the device with Device Provisioning Service.</span></span>

<span data-ttu-id="39a24-152">有关 Limpet 的设备预配服务注册过程的更多详细信息，请 [参阅此存储](https://github.com/ms-iot/azure-client-tools/blob/master/docs/limpet/limpet.md)库。</span><span class="sxs-lookup"><span data-stu-id="39a24-152">For more details on the Device Provisioning Service registration process with Limpet, see this [repo](https://github.com/ms-iot/azure-client-tools/blob/master/docs/limpet/limpet.md).</span></span>

<span data-ttu-id="39a24-153">许可证： Limpet 根据 MIT 开源许可证授权。</span><span class="sxs-lookup"><span data-stu-id="39a24-153">License: Limpet is licensed under the MIT open-source license.</span></span>
